# 网页转Markdown 用户脚本 v2.0 🚀

[English](https://github.com/Feiyt/web-to-markdown/blob/main/README.md)

**简介:**
这是一个增强版 Tampermonkey 用户脚本 (v2.0)，具备智能页面类型检测和排版保持功能，能够智能地将网页内容转换为 Markdown 格式。它具有智能内容选择、平台特定优化，并保持原网页格式的一致性。

## ✨ 核心功能

### 🧠 智能页面类型检测
- **自动识别**: 自动识别页面类型（GitHub、知乎、掘金、CSDN、微信文章、技术文档、新闻等）
- **动态菜单**: 菜单选项根据检测到的页面类型自适应（如"转换GitHub仓库为Markdown"）
- **类型特定处理**: 为每个平台使用优化的选择器和清理规则

### 🎯 增强的内容选择
- **优先级选择器**: 使用页面类型特定的选择器进行精确内容提取
- **智能评分系统**: 评估内容质量，选择最佳容器
- **多级回退**: 当主要选择器失败时自动尝试备用选择器

### 📋 丰富的元信息集成
- **自动生成头部**: 包括页面标题、URL、转换日期、作者信息
- **平台特定信息**: 为GitHub添加仓库星数、为微信添加发布时间等
- **结构化元数据**: 美观的Markdown格式页面信息

### 🎨 排版保持
- **增强的Turndown规则**: 改进的段落处理、换行、格式元素
- **排版支持**: 删除线、下划线、上标、下标、高亮
- **HTML元素保持**: 在需要时保持特定HTML标签（kbd、small等）

### 🛠 平台特定优化
- **GitHub**: 仓库信息、星数统计、Issue编号、代码文件处理
- **知乎**: 问题标题、答案结构优化
- **掘金/CSDN**: 文章分类、技术标签
- **微信**: 发布者信息、文章元数据
- **技术文档**: 文档结构、目录

### 📁 智能文件命名
- **类型前缀**: 添加平台特定前缀（如"GitHub_"、"知乎_"）
- **特殊处理**: 
  - GitHub代码文件：`GitHub_Code_filename.md`
  - GitHub Issues：`GitHub_Issue_123_title.md`
  - 仓库README：`GitHub_owner_repo_README.md`

### 💫 增强的用户体验
- **美观通知**: 带页面类型信息的动画下载成功消息
- **更好的错误处理**: 友好的错误消息和解决方案建议
- **内容质量检查**: 对短内容或潜在转换问题发出警告

## 🔧 技术实现

**核心架构:**

*   **元数据块 (`// ==UserScript==`):** 定义脚本名称、版本 (2.0)、描述、依赖库 (`turndown`, `turndown-plugin-gfm`) 和必需的 `GM_*` 函数。
*   **页面类型检测 (`detectPageType()`):** 分析URL、标题和元描述以识别平台和内容类型。
*   **智能内容选择 (`getContentSelectors()`):** 根据检测到的页面类型返回按优先级排序的选择器。
*   **增强内容节点 (`getPageContentNode()`):** 
    *   使用类型特定选择器进行精确内容提取
    *   实现智能评分系统进行内容质量评估
    *   应用具有平台特定规则的多阶段清理
*   **元数据生成 (`getPageMetadata()`):** 创建包含平台特定详细信息的结构化页面信息。
*   **排版保持 (`enhanceTurndownService()`):** 配置高级Turndown规则以更好地保持格式。
*   **后处理 (`postProcessMarkdown()`):** 通过格式清理和一致性改进优化最终Markdown。
*   **智能下载 (`convertAndDownload()`):**
    *   生成类型合适的文件名
    *   通过多种回退方法优雅地处理下载失败
    *   通过通知提供丰富的用户反馈

## 🌐 支持的平台

| 平台 | 图标 | 特殊功能 |
|----------|------|------------------|
| GitHub仓库 | 📦 | 仓库信息、星数统计、贡献者详情 |
| GitHub代码文件 | 💻 | 文件路径识别、语言检测 |
| GitHub Issues | 🐛 | Issue编号、状态跟踪 |
| 微信公众号文章 | 💬 | 发布时间、作者信息 |
| 知乎内容 | 🤔 | 问题标题、答案结构 |
| 掘金文章 | 💎 | 文章分类、技术标签 |
| CSDN博客 | 🔧 | 博客分类、技术分类 |
| 技术文档 | 📚 | 文档结构、导航 |
| 新闻文章 | 📰 | 发布时间、来源信息 |
| 博客文章 | 📝 | 作者详情、分类信息 |
| 通用网页 | 🌐 | 基础信息提取 |

**下载地址:**  https://greasyfork.org/zh-CN/scripts/532670-webpage-to-markdown<br>  

![image](https://github.com/user-attachments/assets/50300a48-a91d-4d24-a3f8-7f66ef076bf9)  

## 📖 使用方法

1.  确保已安装 Tampermonkey（或兼容的）浏览器扩展。
2.  从上面的下载链接安装此用户脚本 (v2.0)。
3.  访问您想要转换的任何网页。
4.  点击浏览器工具栏中的 Tampermonkey 图标。
5.  选择动态生成的选项（例如"🔧 转换CSDN文章为Markdown (v2.0 Enhanced)"）。
6.  脚本将自动检测页面类型并相应地进行转换。
7.  您的浏览器将下载具有适当文件名的Markdown文件。

## 🔧 高级设置

### Tampermonkey下载配置

**如果无法下载 `.md` 文件：**
1. 进入 Tampermonkey 管理面板 → 设置标签
2. 将"配置模式"从"新手"改为"高级"
3. 向下滚动到"下载 BETA"部分
4. 在"文件扩展名白名单"框中，单独添加一行 `*.md`
5. 点击"保存"并刷新页面

**备选方案：使用内置回退**
- 如果Tampermonkey下载失败，脚本会自动回退到浏览器下载
- 无需配置 - 提示时点击"确定"即可

## 🆕 v2.0 版本新功能

### 主要改进
- ✅ **智能页面检测**: 自动识别11+种平台类型
- ✅ **增强内容提取**: 针对不同平台的80+专用选择器
- ✅ **丰富元数据**: 自动生成包含平台特定详细信息的页面信息
- ✅ **更好的排版**: 支持高级格式（删除线、上标等）
- ✅ **智能文件命名**: 平台感知的文件名生成
- ✅ **改进错误处理**: 优雅的回退和用户友好的消息
- ✅ **质量保证**: 内容验证和转换质量指标

### 平台支持扩展
- 🔥 **GitHub**: 全面支持仓库、代码文件、Issues和文档
- 🔥 **中文平台**: 优化了知乎、掘金、CSDN、微信文章
- 🔥 **技术网站**: 增强了文档和教程网站的支持
- 🔥 **新闻和博客**: 更好地提取新闻文章和博客文章

## ⚠️ 重要说明

1.  **内容准确性**: 此脚本提供智能内容转换，但无法保证100%准确性。请自行审查转换后的内容。

2.  **版权合规**: 请勿在未经许可的情况下使用此脚本下载受版权保护或付费内容。作者对版权违规行为不承担责任。请尊重知识产权。

3.  **平台限制**: 虽然脚本支持许多平台，但某些网站可能具有需要手动调整的独特结构。

4.  **浏览器兼容性**: 在Chrome、Firefox和Edge上测试。需要Tampermonkey或兼容的用户脚本管理器。

## 🔄 版本历史

- **v2.0**（当前版本）: 智能页面检测、增强平台支持、丰富元数据
- **v2.0**: 改进内容选择、更好的错误处理、增强通知
- **v1.0**: 基本网页到Markdown转换

---

**用 ❤️ 为开发者社区制作**
